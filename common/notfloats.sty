%%
%% This is file `notfloats.sty',
%% generated by hand.

%%% Provides the "hereFig" and "hereTab" environments, both of which happen on a minipage.
%%% The required argument is the width of the minipage, which is either
%%% \columnwidth or \textwidth, for OLS purposes.
%%%
%%% Instead of \caption and \label, use \hereCaption and \hereLabel.
%%% Other than that, it should be highly similar to the figure/table
%%% environments.  One important difference: you can put a minipage into
%%% a figure, but you can't put a figure into a hereFig (nor onto a 
%%% minipage, which is the reason for the restriction).
%%%
%%% Author: J.W. Lockhart
%%% License: either the GNU General Public License v2 or later (your choice), or
%%% the LaTeX Project Public License, V1.2 or later (your choice).
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\def\filedate{2008/07/04}
\def\fileversion{1.00}
\ProvidesPackage{notfloats}[\filedate\space v\fileversion
  \space Tables and Figures that Really Appear HERE]

\newenvironment{hereFig}[1]{%
\begin{minipage}{#1}%
\def\@currentlabel{\thefigure}%
\def\@currentHerelabelname{thefigure}%
\def\@currentHerelabstr{figure}%
\def\@currentHereType{figure}%
\def\@currentHerelabFmt{Figure}%
\def\@currentHereHref{figure.\@currentlabel}%
\def\@currentHereWrite{lof}%
}{\end{minipage}}

\newenvironment{hereTab}[1]{%
\begin{minipage}{#1}%
\def\@currentlabel{\thetable}%
\def\@currentHerelabelname{thetable}%
\def\@currentHerelabstr{table}%
\def\@currentHereType{table}%
\def\@currentHerelabFmt{Table}%
\def\@currentHereHref{Table.\@currentlabel}%
\def\@currentHereWrite{lot}%
}{\end{minipage}}

\newif\ifHere@isHyper
\Here@isHyperfalse

\@ifpackageloaded{hyperref}{\Here@isHypertrue}{}

\ifHere@isHyper
  %% \@writefile{lof}{\contentsline {figure}{\numberline {FigNo}{\ignorespaces Capt}}{PgNo}{figure.FigNo}}
  \def\hereWriteContLine{%
    \protected@write\@auxout{}{%
      \string\@writefile{\@currentHereWrite}{%
        {\string\contentsline \space%
        {\@currentHerelabstr}{\string\numberline \space%
        {\@currentlabel}{\string\ignorespaces \space%
         \@currentHereCaption }}{\thepage}{\@currentHereHref}}%
      }%
    }%
  }

  %%% {labelName} {{FigNo}{PageNo}{Caption\relax}{figure.FigNo}{empty}}
  \def\hereWriteNewlabel#1{%
    \protected@write\@auxout{}{%
      \string\newlabel{#1}{%
        {\@currentlabel}%
        {\thepage}%
        %%%{\expandafter\strip@period\@currentHerelabstr\relax.\relax\@@@}%
        {\expandafter\@currentHereCaption\relax}%
        {\@currentHereHref}{}%
      }%
    }%
  }

\else
  %% \@writefile{lof}{\contentsline {figure}{\numberline {FigNo}{\ignorespaces Capt }}{PgNo}}
  %% \@writefile{lot}{\contentsline {table}{\numberline {TabNo}{\ignorespaces Capt }}{PgNo}}
  \def\hereWriteContLine{%
    \protected@write\@auxout{}{%
      \string\@writefile{\@currentHereWrite}{%
        {\string\contentsline \space%
        {\@currentHerelabstr}{\string\numberline \space%
        {\@currentlabel}{\string\ignorespaces \space%
         \@currentHereCaption }}{\thepage}}%
      }%
    }%
  }

  %% \newlabel{LabelName}{{FigNo}{PgNo}}
  \def\hereWriteNewlabel#1{%
    \protected@write\@auxout{}{%
      \string\newlabel{#1}{%
        {\@currentlabel}%
        {\thepage}%
      }%
    }%
  }

\fi

%% Also need:
%% \@writefile{lof}{\contentsline {figure}{\numberline {FigNo}{\ignorespaces Capt}}{PgNo}{figure.FigNo}}
%% \@writefile{lot}{\contentsline {table}{\numberline {1}{\ignorespaces Capt }}{2}}

\providecommand{\hereCaption}[1]{%
\def\@currentHereCaption{#1}%
\stepcounter{\@currentHerelabstr}%
\ifHere@isHyper%
  \@currentHerelabFmt{} {\@currentlabel}.  \hyperdef{\@currentHereType}{\@currentlabel}{\@currentHereCaption}%
\else%
  \@currentHerelabFmt{} {\@currentlabel}.  \@currentHereCaption%
\fi%
\hereWriteContLine%
}

\def\hereLabel#1{%
  \@bsphack
  \begingroup
    \def\ref{\protect\ref}%
    \edef\@currentHerelabstr{%
      \expandafter\strip@prefix\meaning\@currentHerelabelname
    }%
    \ifHere@isHyper%
      \def\@currentlabelname{\@currentHerelabstr}%
      \edef\@currentlabstr{%
        \expandafter\strip@prefix\meaning\@currentHerelabelname
      }%
      %% \hyperdef{figure}{\@currentlabel}{#1}%
    \fi%
    \hereWriteNewlabel{#1}%
  \endgroup
  \@esphack
}%

\def\@currentHerelabelname{}
\def\@currentHereHref{}
\def\@currentHereCaption{}

\endinput



%%
%% End of file `notfloats.sty'.
